<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S·ª≠a S·∫£n Ph·∫©m</title>
    <link rel="stylesheet" href="/stylesheets/style.css">
</head>
<body>
<%- include('../partials/navbar') %>
<div class="container">
    <h1>‚úèÔ∏è Ch·ªânh s·ª≠a s·∫£n ph·∫©m</h1>

    <form method="post" enctype="multipart/form-data">
        <input name="name" value="<%= product.name %>" placeholder="T√™n s·∫£n ph·∫©m" required />
        <input name="price" type="number" value="<%= product.price %>" placeholder="Gi√° (VNƒê)" required />
        <input name="quantity" type="number" value="<%= product.quantity %>" placeholder="S·ªë l∆∞·ª£ng" required />

        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">Danh m·ª•c:</label>
        <select name="categoryId" style="width: 100%; padding: 12px 15px; margin-bottom: 18px; border-radius: 8px; border: 2px solid #e0e0e0;">
            <option value="">-- Ch∆∞a ph√¢n lo·∫°i --</option>
            <% categories.forEach(cat => { %>
                <option value="<%= cat.id %>" <%= product.categoryId === cat.id ? 'selected' : '' %>><%= cat.name %></option>
            <% }) %>
        </select>

        <% if (product.url_image) { %>
            <div style="margin-bottom: 15px;">
                <p style="margin-bottom: 8px; color: #666; font-weight: 600;">·∫¢nh hi·ªán t·∫°i:</p>
                <img src="<%= product.url_image %>" width="120" style="border-radius: 8px; box-shadow: 0 3px 10px rgba(0,0,0,0.2);"/>
            </div>
        <% } %>

        <input type="hidden" name="oldImage" value="<%= product.url_image %>" />
        
        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">Ch·ªçn ·∫£nh m·ªõi t·ª´ S3:</label>
        <select name="selectedImage" id="imageSelect" style="width: 100%; padding: 12px 15px; margin-bottom: 18px; border-radius: 8px; border: 2px solid #e0e0e0;">
            <option value="">-- Gi·ªØ ·∫£nh hi·ªán t·∫°i --</option>
            <% images.forEach(img => { %>
                <option value="<%= img.url %>"><%= img.key %></option>
            <% }) %>
        </select>
        
        <div id="imagePreview" style="margin-bottom: 15px; text-align: center;"></div>
        
        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">Ho·∫∑c upload ·∫£nh m·ªõi:</label>
        <input type="file" name="image" accept="image/*" />

        <button type="submit">üíæ C·∫≠p nh·∫≠t s·∫£n ph·∫©m</button>
    </form>

    <a href="/products" style="margin-top: 20px; display: inline-block;">‚¨ÖÔ∏è Quay l·∫°i danh s√°ch</a>
</div>

<script>
document.getElementById('imageSelect').addEventListener('change', function() {
    const url = this.value;
    const preview = document.getElementById('imagePreview');
    if (url) {
        preview.innerHTML = '<p style="margin-bottom: 8px; color: #666; font-weight: 600;">Preview ·∫£nh m·ªõi:</p><img src="' + url + '" width="200" style="border-radius: 8px; box-shadow: 0 3px 10px rgba(0,0,0,0.2);">';
    } else {
        preview.innerHTML = '';
    }
});
</script>
</body>
</html>
